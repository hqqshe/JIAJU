require(["/Content/minjs/config.js"],function(){require(["jquery","base","utils","pinyin","pop_window","laydate","domReady"],function(a,b,c,d){function e(){a.when(b.getResponsData({shopId:p},"/ERPOrder/GetCustomerBrandProducttList")).done(function(a){q=a.data,l=a.isExamine,m=a.isLock,f(a.data)})}function f(b){if(!b.length)return void a.Message({type:"alert",content:"该客户还未添加品牌！"});for(var c=a("#brand_select ._opacity_select"),d=0;d<b.length;d++){var e=a('<option value="'+b[d].brand.id+'">'+b[d].brand.name+"</option>");c.append(e)}}function g(b){var c=a("#pro_select").clone().removeAttr("id").show();a("select",c);a("._select_text",c).text(b[0].model_name).attr("_id",b[0].id);for(var e=a("._selct_items ul",c),f=0;f<b.length;f++){var g=a(o);g.attr("_py",d.getCamelChars(b[f].model_name).toLowerCase()).find("a").attr("_id",b[f].id).text(b[f].model_name),e.append(g)}return c}function h(b,c,d){a(b).find("td").each(function(b,e){2==b?(a(e).text(c.format),a(e).attr("model",c.produce_name),a(e).attr("unit",c.unit)):3==b?a(e).text(c.color):4==b?a(e).text(c.standard_price):5==b?a(e).text(d):7==b?a(e).text(c.toal_lock_num):8==b?a(e).text(c.total_avaible_num):10==b?a(e).find("input[name=lock_store]").eq(m).attr("checked","true"):11==b&&a(e).find("input[name=check]").eq(l).attr("checked","true")})}function i(){var b=[];return a(".brand_tab tbody tr").each(function(c,d){var e={};a("td",a(d)).each(function(b,c){0==b?(e.brand_id=a(c).find("select").val(),e.brand_name=a(c).find("._select_text").text()):1==b?(e.product_id=a(c).find("._select_text").attr("_id"),e.product_model=a(c).find("._select_text").text()):2==b?(e.product_format=a(c).text(),e.product_name=a(c).attr("model"),e.unit=a(c).attr("unit")):3==b?e.product_color=a(c).text():5==b?e.product_price=a(c).text():6==b?e.product_number=a(c).children().val():9==b?e.factory_delivery_day=a(c).children().val():10==b?e.lockStock=a(c).find("input[type='radio']:checked").parent().index():11==b&&(e.checkFiance=a(c).find("input[type='radio']:checked").parent().index())}),e.remarks=a("textarea",a(d)).val(),b.push(e)}),b}function j(){var b={};return b.shopId=p,b.shopName=a(".name").text(),b.orderId=a(".order_num").val(),b.factory_consumer_address=a("#address").val(),b.factory_consumer_postcode=a("#post_code").val(),b.factory_consumer_linkman=a("#link_man").val(),b.factory_consumer_phone=a("#phone").val(),b.orderInfo=i(),b}function k(b){if(""==b.orderId)return a.Message({type:"alert",content:"请输入订单号！"}),!1;if(0==b.orderInfo.length)return a.Message({type:"alert",content:"请添加至少一条产品信息！"}),!1;for(var c=!0,d=0;d<b.orderInfo.length;d++){if(b.orderInfo[d].brand_id==-1){a.Message({type:"alert",content:"第"+(d+1)+"件产品没有选择品牌！"}),c=!1;break}if(b.orderInfo[d].product_id==-1){a.Message({type:"alert",content:"第"+(d+1)+"件产品没有选择产品！"}),c=!1;break}if(""==b.orderInfo[d].product_number){a.Message({type:"alert",content:"第"+(d+1)+"件产品没有输入数量！"}),c=!1;break}if(""==b.orderInfo[d].factory_delivery_day){a.Message({type:"alert",content:"第"+(d+1)+"件产品没有输入交货日期！"}),c=!1;break}}return c}b.init();var l,m,n=' <tr class="select">                                                                                                                                                                           <td></td>                                                                                                                                                                                             <td></td>                                                                                                                                                                                            <td  class="_td_20 _over_text" ></td>                                                                                                                                                                                             <td></td>                                                                                                                                                                                             <td></td>                                                                                                                                                                                             <td></td>                                                                                                                                                                                             <td  class="_td_10 _over_text" ><input type="text"placeholder="数量" onkeyup="this.value = this.value.replace(/D/g, \'\')" onafterpaste="    this.value = this.value.replace(/D/g, \'\')"></td>                                            <td></td>                                                                                                                                                                                            <td></td>                                                                                                                                                                                            <td><input type="text" placeholder="交货日期"></td>                                                                                <td> <form>                                                                                                                                     <label><input type="radio" name="lock_store" value="0" >是</label>                                                                  <label><input type="radio" name="lock_store" value="1" >否</label></form>                                             </td>                                                                                                                                                                                                     <td><form>                                                                                                                                      <label><input type="radio" name="check" value="0" >是</label>                                                                           <label><input type="radio" name="check" value="1">否</label></form>                                                        </td>                                                                                                                                                                                                     <td class="big_input"><textarea></textarea></td>                                                                                                         <td><a href="javascript:;" class="dele">×</a></td>                                                                                                     </tr>',o='<li><a href="javascript:void(0);"></a></li>',p=window.location.search.split("=")[1],q={};e(),a(".add_brand").on("click",function(){var b=a(n),c=a("#brand_select").clone().removeAttr("id").show();b.children().first().append(c),a("input:eq(1)",b).bind("click",function(){a("#laydate").attr("id",""),a(this).attr("id","laydate"),laydate({elem:"#laydate",format:"YYYY-MM-DD",isclear:!1,istime:!1,istoday:!1})}),a(".dele",b).bind("click",function(){var b=a(this).parent().parent();a.Message({type:"confirm",content:"您确定要删除该条信息?",okFun:function(){b.remove()}})}),c.find("select").bind("change",function(){var c=a(this).val();if(b.find("input").val(""),b.find("td").each(function(b,c){1!=b&&2!=b&&3!=b&&4!=b&&5!=b&&7!=b&&8!=b||a(c).empty()}),c!=-1)for(var d=0;d<q.length;d++)if(q[d].brand.id==c&&q[d].product.length>0){var e=g(q[d].product);b.find("td:eq(1)").append(e),e.find("a").bind("click",function(){var c=a(this).attr("_id");if(b.find("input").val(""),b.find("td").each(function(b,c){2!=b&&3!=b&&4!=b&&5!=b&&7!=b&&8!=b||a(c).empty()}),c!=-1)for(var e=0;e<q[d].product.length;e++)if(q[d].product[e].id==c){h(b,q[d].product[e],q[d].customerPrice[e]);break}}),e.find("a").eq(0).trigger("click");break}}),a(".brand_tab tbody").append(b)}),a(".sub_mit").on("click",function(){var d=j();k(d)&&(d.orderInfo=c.json2str(d.orderInfo),a.when(b.getResponsData(d,"/ERPOrder/submitNewOrder","post")).done(function(b){1===b.code?window.location.href="/ERPOrder/OrderList":a.Message({type:"alert",content:b.message})}))})})});