require(["/Content/minjs/config.js"],function(){require(["jquery","pop_window","base","laydate","domReady"],function(a,b,c,d,b){function e(){var b=0;return a("._ajax_container tbody tr.plus").each(function(c,d){var e=parseFloat(a(d).children().eq(14).text());b=e?b+=e:null}),b}function f(){var b="";return a("._ajax_container tbody tr.plus").each(function(c,d){var e=a(d).attr("_id");b+=e,b+=","}),b.replace(/,$/,"")}c.init(),require(["laydate"],function(){var a={elem:"#start_date",format:"YYYY-MM-DD",max:"2099-06-16 23:59:59",istime:!1,istoday:!1,isclear:!1,issure:!1,choose:function(a){b.min=a,b.start=a}},b={elem:"#end_date",format:"YYYY-MM-DD",max:"2099-06-16 23:59:59",istime:!1,istoday:!1,isclear:!1,issure:!1,choose:function(b){a.max=b,_load_items(1)}};laydate(a),laydate(b);var c={elem:"#start_date1",format:"YYYY-MM-DD",max:"2099-06-16 23:59:59",istime:!1,istoday:!1,isclear:!1,issure:!1,choose:function(a){b.min=a,b.start=a}},d={elem:"#end_date1",format:"YYYY-MM-DD",max:"2099-06-16 23:59:59",istime:!1,istoday:!1,isclear:!1,issure:!1,choose:function(b){a.max=b,_load_items(1)}};laydate(c),laydate(d)});var g,h=window.location.href.split("=")[1],i=0;window._load_items=function(b){var d="",e={};0===i?(d="/ERPFinance/InfoOrderList",e={searchType:a("#data_type").val(),startTime:a("#start_date").val(),endTime:a("#end_date").val(),payStatus:a("#order_status").val(),searchKey:a(".search_input").eq(0).val()}):1===i?(d="/ERPFinance/InfoPendingList",e={startTime:a("#start_date1").val(),endTime:a("#end_date1").val(),searchKey:a(".search_input").eq(1).val()}):d="/ERPFinance/InfoReceipt",e.pageIndex=b,e.id=h,a.when(c.loadHtmlData(e,d)).done(function(b){a("._ajax_container").empty().append(b)}),a("#total_money").text("")},_load_items(1),a(".detail_btn").on("click","a",function(){i=a(this).index(),a(this).addClass("blue cur").siblings().removeClass("blue cur"),i<2?a(".order_seach").eq(i).show().siblings(".order_seach").hide():a(".order_seach").hide(),_load_items(1)}),a("._ajax_container").on("click","tbody input[type=checkbox]",function(){if(1===i){var b=0;a("._ajax_container .plus td:nth-child(11)").each(function(c,d){b+=+a(d).text()}),b?a("#total_money").text("欠款为："+b):a("#total_money").text("")}}),a("._ajax_container").on("click",".check",function(){order_id=a(this).attr("_id");var b=a(this).parents("tr").eq(0).children();a(".plan_con .order_info tbody td").each(function(c,d){4===c&&a(d).text(b.eq(9).text())}),a(".plan_con").fadeIn()}),a(".plan_con").on("click",".sub_mit",function(){a.when(c.getCodeData({planId:order_id,examineState:a(".plan_con input[name=check]:checked").val(),remark:""},"/ERPFinance/ExaminePlanOut")).done(function(){a.Message({type:"alert",content:"提交成功！"}),a(".plan_con").fadeOut(),_load_items(1)})}),a("._ajax_container").on("click",".deposit,.pay",function(){a(this).hasClass("pay")?a(".pay_con").fadeIn().find(".panl_name").text("冲抵"):a(".pay_con").fadeIn().find(".panl_name").text("定金"),g=a(this).attr("_id")}),a(".all_pay").on("click",function(){var b=a("._ajax_container tbody tr.plus").length;return b<1?void a.Message({type:"alert",content:"请选择要冲抵的订单！"}):void a(".all_pay_con").fadeIn().find(".tip").eq(0).next().text(b).parent().next().children().eq(1).text(e())}),a("._btns").on("click","a",function(){a(".invent_con").fadeIn().find(".sub_num").val("").parent().find(".tip_txt").val("")}),a(".invent_con").on("click",".sub_money",function(){var b=parseFloat(a(".invent_con .sub_num").val());return b?void a.when(c.getCodeData({shopId:h,money:b,chargeType:a(".invent_con input[name='chargeType']:checked").val(),remarks:a(".invent_con .tip_txt").val()},"/ERPFinance/Recharge")).done(function(){a.Message({type:"alert",content:"提交成功！"}),a(".invent_con").fadeOut(),window.location.reload()}):void a.Message({type:"alert",content:"请输入正确金额！"})}),a(".pay_con").on("click",".submit",function(){var b=parseFloat(a(".pay_con .sub_num").val());return b?void a.when(c.getResponsData({saleId:g,shopId:h,type:a("#data_type").val(),money:a(".pay_con input").val(),startTime:a("#start_date").val(),endTime:a("#end_date").val()},"/ERPFinance/PayTheOrderMoney")).done(function(b){a.Message({type:"alert",content:b.message}),a(".pay_con").fadeOut().find(".sub_num").val(""),_load_items(1)}):void a.Message({type:"alert",content:"请输入正确金额！"})}),a(".all_pay_con").on("click",".submit",function(){var b=f();if(""==b)return void a.Message({type:"alert",content:"请选择要冲抵的订单！"});var d=parseFloat(a(".all_pay_con .sub_num").val());return d?void a.when(c.getResponsData({shopId:h,orderList:b,type:a("#data_type").val(),startTime:a("#start_date").val(),endTime:a("#end_date").val(),money:d},"/ERPFinance/PayOrderListMoney")).done(function(b){a.Message({type:"alert",content:b.message}),a(".all_pay_con").fadeOut(),_load_items(1)}):void a.Message({type:"alert",content:"请输入正确金额！"})})})});