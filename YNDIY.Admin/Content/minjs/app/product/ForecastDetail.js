require(["/Content/minjs/config.js"],function(){require(["jquery","base","laydate","pop_window","utils","domReady"],function(a,b){function c(){var b="";return a("._ajax_container tbody tr.plus").each(function(c,d){var e=a(d).attr("_id");b+=e,b+=","}),b.replace(/,$/,"")}function d(){var b={};b.number=a("._number").val(),b.customerId=a("#customer").val(),b.customer=a("#customer option:selected").text(),b.createTime=a("#pop_start").val(),b.deliveryTime=a("#pop_end").val(),b.remarks=a("._plan_remark").val();var d=a(".plan_con .order_info ._produt_info td");return b.brandId=d.eq(0).attr("_id"),b.brandName=d.eq(0).text(),b.productId=d.eq(1).attr("_id"),b.productName=d.eq(1).text(),b.productModel=d.eq(2).text(),b.productFormat=d.eq(3).text(),b.productColor=d.eq(4).text(),b.saleOrderIds=c(),b}b.init(),require(["laydate"],function(){var b={elem:"#start_date",format:"YYYY-MM-DD",max:"2099-06-16 23:59:59",istime:!1,istoday:!1,choose:function(a){c.min=a,c.start=a}},c={elem:"#end_date",format:"YYYY-MM-DD",max:"2099-06-16 23:59:59",istime:!1,istoday:!1,choose:function(a){b.max=a}},d={elem:"#pop_start",format:"YYYY-MM-DD",max:"2099-06-16 23:59:59",istime:!1,istoday:!1,choose:function(a){c.min=a,c.start=a}},e={elem:"#pop_end",format:"YYYY-MM-DD",max:"2099-06-16 23:59:59",istime:!1,istoday:!1,choose:function(a){b.max=a}};laydate(d),laydate(e),laydate(b),laydate(c),a("#pop_start").val(laydate.now).attr("disabled","disabled")});var e=window.location.search.split("=")[1];window._load_items=function(c){a.when(b.loadHtmlData({productId:e,startTime:a("#start_date").val(),endTime:a("#end_date").val(),isRelation:a("#isRelation").val(),shopName:a(".search_input").val(),pageIndex:c},"/ERPProduct/GetForecastDetail")).done(function(b){a("._ajax_container").empty().append(b)})},_load_items(1),a(".make_plan").on("click",function(){var b=a("._ajax_container tbody tr.plus");if(b.length>0){var c=0;b.each(function(b,d){c+=+a(d).attr("_wait_process")})}a(".plan_con").fadeIn().find("._number").val(c),a("#pop_end,._plan_remark").val("")}),a(".plan_con").on("click",".sub_mit",function(){var c=d();if(!/^[1-9]\d*$/.test(c.number))return void a.Message({type:"alert",content:"请输入正确数量！"});if("undefined"==typeof c.customerId||""==c.customer)return void a.Message({type:"alert",content:"请选择客户"});if(""==c.createTime)return void a.Message({type:"alert",content:"请选择下单日期"});if(""==c.deliveryTime)return void a.Message({type:"alert",content:"请选择交货日期"});a(".plan_con input").eq(2).val();a.when(b.getCodeData(c,"/ERPProduct/submitAddProductionOrder")).done(function(){a.Message({type:"alert",content:"保存成功！"}),a(".plan_con").fadeOut(),_load_items(1)})})})});