require(["/Content/minjs/config.js"],function(){require(["jquery","base","laydate","pop_window","utils","domReady"],function(a,b){function c(b){var c=a("._check_customer");c.empty();for(var d=0;d<b.length;d++){var e=a('<div class="_select_customer_item" _id="'+b[d].id+'">'+b[d].shop_name+"</div>");e.bind("click",function(){var b=a(this);b.parent().prev().attr("_id",b.attr("_id")).val(b.text().replace(/\s/g,"")),b.parent().hide()}),c.append(e)}}function d(){var b={};return b.number=a("._number").val(),b.customerId=a("._customer_input").attr("_id"),b.customer=a("._customer_input").val(),b.createTime=a("#pop_start").val(),b.deliveryTime=a("#pop_end").val(),b.remarks=a("._plan_remark").val(),a("._produt_info td").each(function(c,d){0==c?(b.productName=a(d).text().replace(/\s/g,""),b.productId=a(d).attr("_id")):1==c?(b.brandName=a(d).text().replace(/\s/g,""),b.brandId=a(d).attr("_id")):2==c?b.productModel=a(d).text().replace(/\s/g,""):3==c?b.productFormat=a(d).text().replace(/\s/g,""):4==c&&(b.productColor=a(d).text().replace(/\s/g,""))}),b}b.init(),require(["laydate"],function(){var b={elem:"#start_date",format:"YYYY-MM-DD",max:"2099-06-16 23:59:59",istime:!1,istoday:!1,choose:function(a){c.min=a,c.start=a}},c={elem:"#end_date",format:"YYYY-MM-DD",max:"2099-06-16 23:59:59",istime:!1,istoday:!1,choose:function(a){b.max=a,_load_items(1)}},d={elem:"#pop_start",format:"YYYY-MM-DD",max:"2099-06-16 23:59:59",istime:!1,istoday:!1,choose:function(a){c.min=a,c.start=a}},e={elem:"#pop_end",format:"YYYY-MM-DD",max:"2099-06-16 23:59:59",istime:!1,istoday:!1,choose:function(a){b.max=a}};laydate(d),laydate(e),laydate(b),laydate(c),a("#pop_start").val(laydate.now)});var e,f=null,g=null;window._load_items=function(c){a.when(b.loadHtmlData({orderStartDate:a("#start_date").val(),orderEndDate:a("#end_date").val(),safeState:a("#order_status").val(),productName:a(".search_input").val(),pageIndex:c},"/ERPProduct/GetProductForecast")).done(function(b){a("._ajax_container").empty().append(b)})},_load_items(1),a("._opacity_select").on("change",function(){_load_items(1)}),a("._ajax_container").on("click",".make_plan",function(){var d=a(this).parent().parent().find("td:eq(1)").attr("_id");if("undefined"==typeof d)return void a.Message({type:"alert",content:"请求品牌参数错误"});g!=d||null==f?a.when(b.getData({brandId:d},"/ERPProduct/GetCustomerListByBrandId")).done(function(a){c(a),f=a,g=d}):c(f);var h=a(this).parents("tr").children();a(".plan_con .order_info tbody td").each(function(b,c){a(c).text(h.eq(b).text()),0==b&&a(c).attr("_id",h.eq(0).attr("_id")),1==b&&a(c).attr("_id",h.eq(1).attr("_id"))}),a(".plan_con").fadeIn(),e=a(this).attr("_id"),a("._customer_input").attr("_id","").val(""),a("#pop_end,._number,._plan_remark").val("")}),a("._customer_input").bind("click",function(){return a("._check_customer").show(),!1}),a("body").bind("click",function(){a("._check_customer").hide()}),a(".plan_con").on("click",".sub_mit",function(){var c=d();if(!/^[1-9]\d*$/.test(c.number))return void a.Message({type:"alert",content:"请输入正确出库数量！"});if("undefined"==typeof c.customerId||""==c.customer)return void a.Message({type:"alert",content:"请选择客户"});if(""==c.createTime)return void a.Message({type:"alert",content:"请选择下单日期"});if(""==c.deliveryTime)return void a.Message({type:"alert",content:"请选择交货日期"});a(".plan_con input").eq(2).val();a.when(b.getCodeData(c,"/ERPProduct/submitAddProductionOrder")).done(function(){a.Message({type:"alert",content:"提交成功！"}),a(".plan_con").fadeOut(),_load_items(1)})})})});