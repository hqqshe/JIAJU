require(["/Content/minjs/config.js"],function(){require(["jquery","pop_window","base","laydate","domReady"],function(a,b,c,b,b){function d(){a.when(c.getData({orderId:f},"/ERPOrder/GetSaleOrderOutHistory")).done(function(b){var c=a(".join_con .out_history tbody");c.empty();for(var d=0;d<b.length;d++){var e=a(g);e.children().eq(0).text(b[d].plan_out_date),e.children().eq(1).text(b[d].out_count),e.children().eq(2).text(b[d].state),c.append(e)}})}function e(b,d){a.when(c.loadHtmlData({productId:d,id:b},"/ERPOrder/GetAllocation")).done(function(b){a(".get_store_con .pop_con").empty().append(b),a(".get_store_con").fadeIn()})}c.init(),require(["laydate"],function(){var a={elem:"#start_date",format:"YYYY-MM-DD",max:"2099-06-16 23:59:59",istime:!1,istoday:!1,choose:function(a){b.min=a,b.start=a}},b={elem:"#end_date",format:"YYYY-MM-DD",max:"2099-06-16 23:59:59",istime:!1,istoday:!1,choose:function(b){a.max=b,_load_items(1)}};laydate(a),laydate(b)});var f,g="<tr><td></td><td></td><td></td></tr>";window._load_items=function(b){a.when(c.loadHtmlData({status:a("#status").val(),pageIndex:b,start_data:a("#start_date").val(),end_data:a("#end_date").val()},"/ERPStore/GetallotOrderList")).done(function(b){a("._ajax_container").empty().append(b),c.repainWindow()})},_load_items(1),a("._ajax_container").on("click",".join",function(){var b=a(this).parents("tr").eq(0).children();a(".join_con .order_info tbody td").each(function(c,d){4===c?a(d).text(b.eq(10).text()-b.eq(11).text()-b.eq(12).text()):a(d).text(b.eq(c+10).text())}),f=a(this).attr("_id"),d(),a(".join_con").fadeIn()}),a(".join_con").on("click",".sub_mit",function(){var b=parseInt(a(".join_con input").eq(0).val());if(!b)return void a.Message({type:"alert",content:"请输入本次出库数量！"});var d=a(".join_con .order_info tbody td").eq(4).text();if(b>d)return void a.Message({type:"alert",content:"本次出库数量不能超过待出库数量"});var e=a(".join_con input").eq(1).val();if(!e)return void a.Message({type:"alert",content:"请选择出库日期！"});var g=a(".join_con input").eq(2).val();a.when(c.getCodeData({orderId:f,outCount:b,outDate:e,remarks:g},"/ERPOrder/AddStorageOutPlan")).done(function(){a.Message({type:"alert",content:"提交成功！"}),a(".join_con").fadeOut(),_load_items(1)})}),a("._ajax_container").on("click",".get_store",function(){e(a(this).attr("_id"),a(this).attr("pid"))}),a(".get_store_con").on("click",".sub_mit",function(){}),a("._ajax_container").on("click",".dele",function(){var b=a(this),d=b.parents("tr").first().children().eq(0).text();a.Message({type:"confirm",content:"确定删除 "+d+" 销售单？删除后数据不可恢复，请慎重！",okFun:function(){b.attr("_id");a.when(c.getCodeData({order_id:f,outCount:num,outDate:date,remarks:tip},"/ERPOrder/AddStorageOutPlan")).done(function(){a.Message({type:"alert",content:"删除成功！"}),_load_items(1)})}})})})});