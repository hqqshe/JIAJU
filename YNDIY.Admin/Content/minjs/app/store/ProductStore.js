require(["/Content/minjs/config.js"],function(){require(["jquery","base","pop_window","domReady"],function(a,b){function c(){a.when(b.getData({},"/ERPBrand/GetAllBranList")).done(function(a){d(a),_load_items(1)})}function d(b){var c=a(".brandId");c.empty(),c.prev().find("._select_text").text("全部"),c.append(a('<option value="-1">全部</option>'));for(var d=0;d<b.length;d++){var e=a('<option value="1"></option>');e.attr("value",b[d].id).text(b[d].name),c.append(e)}}function e(b){var c=a(".plan_con .pro_tab tbody");if(c.empty(),0!==b.length)for(var d=0;d<b.length;d++){var e=a(g);e.children().eq(0).attr("_id",b[d].id),e.children().eq(1).text(b[d].produce_name),e.children().eq(2).text(b[d].model_name),e.children().eq(3).text(b[d].format).attr("title",b[d].format),e.children().eq(4).text(b[d].color),e.children().eq(5).text(b[d].unit),e.children().eq(6).text(b[d].standard_price),c.append(e)}}b.init();var f,g=' <tr>                                                                                                                                                         <td><input type="radio" name="pro"></td>                                                                         <td></td>                                                                                                                                              <td></td>                                                                                                                                              <td></td>                                                                                                                                              <td class="_td_10 _over_text"></td>                                                                                        <td></td>                                                                                                                                              <td ></td>                                                                                                                                             <td></td>                                                                                                                                              <td></td>                                                                                                                                              <td><input type="text" class="_input_area" placeholder="本次入库数量" onkeyup="this.value = this.value.replace(/D/g, \'\')" onafterpaste="this.value = this.value.replace(/D/g, \'\')"></td>                                    </tr>';window._load_items=function(c){a.when(b.loadHtmlData({brandId:a(".brandId").val(),searchKey:a(".search_input").val(),pageIndex:c},"/ERPStore/GetProductStore")).done(function(b){a("._ajax_container").empty().append(b)})},c(),a("._ajax_container").on("click",".allot",function(){f=a(this).attr("_id");var b=a(this).parents("tr").eq(0).children(),c=a(".allot_con");a("._list_table tbody td",c).each(function(c,d){if(6===c)a(d).text(b.eq(c+3).text());else{if(7===c)return!1;a(d).text(b.eq(c).text()).attr("title",b.eq(c).text())}}),a("._list_table:eq(0) tbody td",c).each(function(c,d){a(d).text(b.eq(c).text())}),c.fadeIn().find("input").val(""),c.find("textarea").val("")}),a(".allot_con").on("click",".sub_mit",function(){var c=a(".allot_con input").eq(0).val();if(""===c||isNaN(c)||c<0)return void a.Message({type:"alert",content:"请输入盘点数量！"});var d=a(".allot_con tip_txt").val();a.when(b.getCodeData({productId:f,packageNumber:a(".allot_con .bag_num").text(),inventoryCount:c,tip:d},"/ERPStore/SetInventory")).done(function(){a.Message({type:"alert",content:"提交成功！"}),a(".allot_con").fadeOut(),_load_items(a("._fontColor").text())})}),a("._ajax_container").on("click",".edit_store",function(){f=a(this).attr("_id"),a(".plan_con").fadeIn()}),a(".plan_con .search_btn").on("click",function(){var c=a(".plan_con .search_input").val();return c?void a.when(b.getData({searchKey:c},"/ERPBrand/GetRelationProducts")).done(function(a){e(a)}):void a.Message({type:"alert",content:"请输入产品型号！"})}),a(".plan_con").on("click",".sub_mit",function(){var c=parseInt(a(".plan_con input").eq(0).val());if(!c)return void a.Message({type:"alert",content:"请输入本次入库数量！"});var d=a(".plan_con input").eq(1).val();if(!d)return void a.Message({type:"alert",content:"请选择出库日期！"});var e=a(".plan_con tip_txt").val();a.when(b.getCodeData({order_id:f,num:c,date:d,tip:e},"/ERPBrand/DeleteProduct")).done(function(){a.Message({type:"alert",content:"提交成功！"}),a(".plan_con").fadeOut(),_load_items(a("._fontColor").text())})})})});