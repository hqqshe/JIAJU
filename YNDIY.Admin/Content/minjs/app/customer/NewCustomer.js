require(["/Content/minjs/config.js"],function(){require(["jquery","base","pop_window","domReady"],function($,base){function initCustomer(){var a=window.location.search;if(/id=\d+/.test(a)){var b=a.match(/id=(\d+)/);cid=b[1],GetCustomerInfo()}}function GetCustomerInfo(){$.when(base.getData({id:cid},"/ERPCustomer/GetCustomerInfoJson")).done(function(a){RenderCustomerInfo(a)})}function RenderCustomerInfo(_data){if($("._input_panel input[type='text']").each(function(a,b){0==a?$(b).val(_data.shop_name):1==a?$(b).val(_data.fandian):2==a?$(b).val(_data.link_man):3==a?$(b).val(_data.jiesuan):4==a?$(b).val(_data.phone):5==a?$(b).val(_data.piaoju):6==a?$(b).val(_data.address_detail):7==a?$(b).val(_data.order_requires):8==a?$(b).val(_data.fahuo):9==a?$(b).val(_data.huoyun):10==a?$(b).val(_data.credit_limit):11==a?$(b).val(_data.huoyun_phone):12==a?$(b).val(_data.tags):13==a?$(b).val(_data.remarks):14==a?$(b).val(_data.fahuo):15==a?$(b).val(_data.remarks):null}),$("._input_panel input[name=check]").eq(_data.is_examine).click(),$("._input_panel input[name=lock_store]").eq(_data.is_lockStore).click(),_data.brands_id){eval("brand_arr="+_data.brands_id);for(var i=0;i<brand_arr.length;i++){var item=$(brand_item),select=$("#brand_select").clone(),text=select.removeAttr("id").show().find("._opacity_select").val(brand_arr[i]).find("option[value="+brand_arr[i]+"]").attr("selected",!0).text();select.find("._select_text").text(text),item.children().first().append(select),$(".brand_tab").append(item)}}}function initSelet(){$.when(base.getData({},"/ERPBrand/GetAllBranList")).done(function(a){fillSelect(a)})}function fillSelect(a){var b=$("#brand_select ._opacity_select");b.empty();for(var c=0;c<a.length;c++){var d=$('<option value="1"></option>');d.attr("value",a[c].id).text(a[c].name),b.append(d)}b.val(a[0].id).prev().find("._select_text").text(a[0].name)}function getInfoItems(){var a={};return $("._input_panel input[type='text']").each(function(b,c){0==b?a.customer_name=$(c).val():1==b?a.fandian=$(c).val():2==b?a.link_name=$(c).val():3==b?a.jiesuan=$(c).val():4==b?a.link_phone=$(c).val():5==b?a.piaoju=$(c).val():6==b?a.link_address=$(c).val():7==b?a.order_requires=$(c).val():8==b?a.fahuo=$(c).val():9==b?a.huoyun=$(c).val():10==b?a.credit_limit=$(c).val():11==b?a.huoyun_phone=$(c).val():12==b?a.tags=$(c).val():13==b?a.remarks=$(c).val():null}),a.is_examine=$("._input_panel input[name=check]:checked").val(),a.is_lockStore=$("._input_panel input[name=lock_store]:checked").val(),a.brand_id=[],$(".brand_tab ._opacity_select").each(function(b,c){a.brand_id.push(parseInt($(c).val()))}),a}function vali(a){if(""==a.customer_name)return alert("请输入客户名称！"),!0;if(""==a.link_name)return alert("请输入联系人姓名！"),!0;if(""==a.link_phone)return alert("请输入联系人电话！"),!0;if(""==a.link_address)return alert("请输入联系地址！"),!0;if(""==a.credit_limit)return alert("请输入信用额度！"),!0;for(var b=0,c=a.brand_id.length;b<c;b++)for(var d=b+1;d<c;d++)if(a.brand_id[b]===a.brand_id[d])return alert("一个品牌只能选择一次，不能重复！"),!0;return!1}base.init();var brand_item=' <tr class="select">                                                                                                                       <td></td>                                                                                                                                      <td><a href="javascript:;" class="dele">×</a></td>                                               </tr>',cid=0;initSelet(),initCustomer(),$(".add_brand").on("click",function(){var a=$(brand_item),b=$("#brand_select").clone();b.removeAttr("id").show(),a.children().first().append(b),$(".brand_tab").append(a)}),$(".brand_tab").on("click",".dele",function(){var a=$(this).parent().prev().find("._select_text").text(),b=$(this);$.Message({type:"confirm",content:"确定删除 "+a+" 品牌？",okFun:function(){b.parent().parent().remove()}})}),$(".sub_mit").on("click",function(){var a=getInfoItems();vali(a)||(a.id=cid,a.brand_id=a.brand_id.join(","),$.when(base.getCodeData(a,"/ERPCustomer/saveCustomer","post")).done(function(){window.location.href="/ERPCustomer/CustomerList"}))})})});